# üé® Esquema Visual de Base de Datos - Sistema de Inventario Industrial

## üó∫Ô∏è Diagrama ERD (Entity Relationship Diagram)

```mermaid
erDiagram
    %% =====================================================
    %% USUARIOS - AZUL
    %% =====================================================
    USERS {
        int id PK "üîë ID √∫nico"
        string email UK "üìß Email √∫nico"
        string password "üîí Contrase√±a encriptada"
        string name "üë§ Nombre completo"
        enum role "üé≠ Rol (ADMIN/USER/VIEWER)"
        boolean is_active "‚úÖ Estado activo"
        timestamp created_at "üìÖ Fecha creaci√≥n"
        timestamp updated_at "üîÑ √öltima actualizaci√≥n"
    }

    %% =====================================================
    %% CATEGOR√çAS - VERDE
    %% =====================================================
    CATEGORIES {
        int id PK "üîë ID √∫nico"
        string name UK "üè∑Ô∏è Nombre categor√≠a"
        text description "üìù Descripci√≥n"
        int parent_id FK "üë• Categor√≠a padre"
        boolean is_active "‚úÖ Estado activo"
        timestamp created_at "üìÖ Fecha creaci√≥n"
        timestamp updated_at "üîÑ √öltima actualizaci√≥n"
    }

    %% =====================================================
    %% UBICACIONES - NARANJA
    %% =====================================================
    LOCATIONS {
        int id PK "üîë ID √∫nico"
        string name "üìç Nombre ubicaci√≥n"
        text description "üìù Descripci√≥n"
        string zone "üè¢ Zona del almac√©n"
        string shelf "üì¶ Estante espec√≠fico"
        boolean is_active "‚úÖ Estado activo"
        timestamp created_at "üìÖ Fecha creaci√≥n"
        timestamp updated_at "üîÑ √öltima actualizaci√≥n"
    }

    %% =====================================================
    %% PROVEEDORES - MORADO
    %% =====================================================
    SUPPLIERS {
        int id PK "üîë ID √∫nico"
        string name "üè¢ Nombre empresa"
        string contact_person "üë§ Persona contacto"
        string email "üìß Email contacto"
        string phone "üìû Tel√©fono"
        text address "üè† Direcci√≥n"
        boolean is_active "‚úÖ Estado activo"
        timestamp created_at "üìÖ Fecha creaci√≥n"
        timestamp updated_at "üîÑ √öltima actualizaci√≥n"
    }

    %% =====================================================
    %% PRODUCTOS - ROJO
    %% =====================================================
    PRODUCTS {
        int id PK "üîë ID √∫nico"
        string name "üîß Nombre instrumento"
        text description "üìù Descripci√≥n detallada"
        string sku UK "üè∑Ô∏è C√≥digo SKU √∫nico"
        numeric price "üí∞ Precio unitario"
        int quantity "üì¶ Cantidad en stock"
        int critical_stock "‚ö†Ô∏è Stock m√≠nimo cr√≠tico"
        int category_id FK "üìÇ Categor√≠a"
        int location_id FK "üìç Ubicaci√≥n"
        int supplier_id FK "üè¢ Proveedor"
        boolean is_active "‚úÖ Estado activo"
        timestamp created_at "üìÖ Fecha creaci√≥n"
        timestamp updated_at "üîÑ √öltima actualizaci√≥n"
    }

    %% =====================================================
    %% MOVIMIENTOS - AMARILLO
    %% =====================================================
    PRODUCT_MOVEMENTS {
        int id PK "üîë ID √∫nico"
        int product_id FK "üîß Producto afectado"
        enum movement_type "üîÑ Tipo (IN/OUT/ADJUSTMENT)"
        int quantity "üìä Cantidad movida"
        int previous_quantity "üìä Cantidad anterior"
        int new_quantity "üìä Nueva cantidad"
        string reason "üí≠ Motivo del movimiento"
        int user_id FK "üë§ Usuario que realiz√≥"
        timestamp created_at "üìÖ Fecha movimiento"
    }

    %% =====================================================
    %% AUDITOR√çA - GRIS
    %% =====================================================
    AUDIT_LOGS {
        int id PK "üîë ID √∫nico"
        string table_name "üìã Tabla afectada"
        int record_id "üîç ID del registro"
        enum action "‚ö° Acci√≥n (CREATE/UPDATE/DELETE)"
        jsonb old_values "üìÑ Valores anteriores"
        jsonb new_values "üìÑ Valores nuevos"
        int user_id FK "üë§ Usuario que realiz√≥"
        inet ip_address "üåê Direcci√≥n IP"
        text user_agent "üåç User agent"
        timestamp created_at "üìÖ Fecha del log"
    }

    %% =====================================================
    %% RELACIONES
    %% =====================================================
    
    %% Relaciones principales
    PRODUCTS ||--o{ PRODUCT_MOVEMENTS : "registra movimientos"
    PRODUCTS }o--|| CATEGORIES : "pertenece a"
    PRODUCTS }o--|| LOCATIONS : "se ubica en"
    PRODUCTS }o--|| SUPPLIERS : "proporcionado por"
    PRODUCT_MOVEMENTS }o--|| USERS : "realizado por"
    AUDIT_LOGS }o--|| USERS : "generado por"
    
    %% Relaci√≥n jer√°rquica de categor√≠as
    CATEGORIES ||--o{ CATEGORIES : "subcategor√≠as"
    
    %% Relaci√≥n de auditor√≠a con todas las tablas
    PRODUCTS ||--o{ AUDIT_LOGS : "auditado"
    CATEGORIES ||--o{ AUDIT_LOGS : "auditado"
    LOCATIONS ||--o{ AUDIT_LOGS : "auditado"
    SUPPLIERS ||--o{ AUDIT_LOGS : "auditado"
```

---

## üéØ **Explicaci√≥n Visual por Colores**

### üîµ **AZUL - USUARIOS**
- **Funci√≥n**: Gesti√≥n de acceso y autenticaci√≥n
- **Caracter√≠sticas**: Roles, permisos, seguridad
- **Relaciones**: Con movimientos y auditor√≠a

### üü¢ **VERDE - CATEGOR√çAS**
- **Funci√≥n**: Clasificaci√≥n jer√°rquica de productos
- **Caracter√≠sticas**: Estructura organizacional
- **Relaciones**: Con productos y subcategor√≠as

### üü† **NARANJA - UBICACIONES**
- **Funci√≥n**: Gesti√≥n f√≠sica del almac√©n
- **Caracter√≠sticas**: Zonas, estantes, organizaci√≥n espacial
- **Relaciones**: Con productos

### üü£ **MORADO - PROVEEDORES**
- **Funci√≥n**: Gesti√≥n de proveedores externos
- **Caracter√≠sticas**: Informaci√≥n de contacto, trazabilidad
- **Relaciones**: Con productos

### üî¥ **ROJO - PRODUCTOS**
- **Funci√≥n**: Entidad central del sistema
- **Caracter√≠sticas**: Stock, precios, SKUs, estado cr√≠tico
- **Relaciones**: Con todas las entidades principales

### üü° **AMARILLO - MOVIMIENTOS**
- **Funci√≥n**: Trazabilidad de inventario
- **Caracter√≠sticas**: Historial de cambios, auditor√≠a
- **Relaciones**: Con productos y usuarios

### ‚ö´ **GRIS - AUDITOR√çA**
- **Funci√≥n**: Seguridad y cumplimiento
- **Caracter√≠sticas**: Logs autom√°ticos, trazabilidad completa
- **Relaciones**: Con todas las entidades

---

## üìä **Flujo de Datos Visual**

```mermaid
graph TD
    A[üë§ Usuario] --> B[üîê Autenticaci√≥n]
    B --> C{üé≠ Rol?}
    
    C -->|ADMIN| D[üîß Gesti√≥n Completa]
    C -->|USER| E[üì¶ Gesti√≥n Inventario]
    C -->|VIEWER| F[üëÄ Solo Consulta]
    
    D --> G[üìÇ Categor√≠as]
    D --> H[üìç Ubicaciones]
    D --> I[üè¢ Proveedores]
    D --> J[üîß Productos]
    D --> K[üìä Movimientos]
    D --> L[üìã Auditor√≠a]
    
    E --> J
    E --> K
    
    F --> M[üìà Reportes]
    
    J --> N[‚ö†Ô∏è Stock Cr√≠tico?]
    N -->|S√ç| O[üö® Alerta]
    N -->|NO| P[‚úÖ Normal]
    
    K --> Q[üìä Actualizar Stock]
    Q --> R[üìã Registrar Movimiento]
    R --> S[üìÑ Log Auditor√≠a]
    
    style A fill:#4CAF50
    style B fill:#2196F3
    style C fill:#FF9800
    style D fill:#9C27B0
    style E fill:#FF5722
    style F fill:#607D8B
    style J fill:#F44336
    style K fill:#FFC107
    style L fill:#795548
    style O fill:#FF0000
    style P fill:#4CAF50
```

---

## üèóÔ∏è **Arquitectura de Capas**

```mermaid
graph TB
    subgraph "üé® PRESENTACI√ìN"
        A[üåê API REST]
        B[üì± Swagger UI]
        C[üîê Autenticaci√≥n]
    end
    
    subgraph "‚öôÔ∏è APLICACI√ìN"
        D[üìã Use Cases]
        E[üîß DTOs]
        F[üìù Validaciones]
    end
    
    subgraph "üè¢ DOMINIO"
        G[üì¶ Entities]
        H[üìÇ Repositories]
        I[üîç Business Rules]
    end
    
    subgraph "üóÑÔ∏è INFRAESTRUCTURA"
        J[üíæ PostgreSQL]
        K[üìä Database]
        L[üîß Services]
    end
    
    A --> D
    B --> A
    C --> A
    D --> G
    E --> D
    F --> E
    G --> H
    H --> J
    I --> G
    J --> K
    L --> J
    
    style A fill:#E3F2FD
    style B fill:#E8F5E8
    style C fill:#FFF3E0
    style D fill:#F3E5F5
    style E fill:#E0F2F1
    style F fill:#FFF8E1
    style G fill:#FCE4EC
    style H fill:#F1F8E9
    style I fill:#E8EAF6
    style J fill:#FFEBEE
    style K fill:#E0F7FA
    style L fill:#F9FBE7
```

---

## üìà **Estados de Stock Visual**

```mermaid
stateDiagram-v2
    [*] --> Normal
    Normal --> Cr√≠tico: quantity <= critical_stock
    Normal --> SinStock: quantity = 0
    Cr√≠tico --> Normal: quantity > critical_stock
    Cr√≠tico --> SinStock: quantity = 0
    SinStock --> Normal: quantity > 0
    
    state Normal {
        [*] --> Verde
        Verde --> Amarillo: quantity < 50%
        Amarillo --> Verde: quantity >= 50%
    }
    
    state Cr√≠tico {
        [*] --> Rojo
        Rojo --> Naranja: quantity > 0
        Naranja --> Rojo: quantity = 0
    }
    
    state SinStock {
        [*] --> Gris
        Gris --> Verde: quantity > 0
    }
```

---

## üéØ **Casos de Uso Visuales**

### üì¶ **Gesti√≥n de Inventario**
```mermaid
sequenceDiagram
    participant U as üë§ Usuario
    participant A as üîê Auth
    participant P as üîß Producto
    participant M as üìä Movimiento
    participant L as üìã Auditor√≠a
    
    U->>A: Login
    A->>U: Token JWT
    U->>P: Crear/Actualizar Producto
    P->>M: Registrar Movimiento
    M->>L: Log Auditor√≠a
    L->>U: Confirmaci√≥n
```

### üö® **Alerta de Stock Cr√≠tico**
```mermaid
sequenceDiagram
    participant S as ‚ö†Ô∏è Sistema
    participant P as üîß Producto
    participant T as üîî Trigger
    participant N as üìß Notificaci√≥n
    participant A as üë§ Admin
    
    S->>P: Verificar Stock
    P->>T: Stock <= Cr√≠tico
    T->>N: Generar Alerta
    N->>A: Enviar Notificaci√≥n
    A->>P: Revisar Producto
```

---

## üé® **Leyenda de S√≠mbolos**

| S√≠mbolo | Significado | Color |
|---------|-------------|-------|
| üîë | Clave Primaria | Dorado |
| üîí | Seguridad/Encriptaci√≥n | Azul |
| üìß | Email/Comunicaci√≥n | Verde |
| üë§ | Usuario/Persona | Azul claro |
| üè∑Ô∏è | Identificador √∫nico | Naranja |
| üì¶ | Inventario/Stock | Rojo |
| ‚ö†Ô∏è | Alerta/Cr√≠tico | Rojo |
| üìä | Datos/M√©tricas | Azul |
| üìã | Auditor√≠a/Logs | Gris |
| üîÑ | Movimiento/Cambio | Amarillo |
| üìÖ | Fecha/Tiempo | Verde |
| ‚úÖ | Activo/V√°lido | Verde |
| ‚ùå | Inactivo/Error | Rojo |

---

**Este esquema visual proporciona una comprensi√≥n clara y did√°ctica de la arquitectura del sistema de inventario industrial.** üé®‚ú® 