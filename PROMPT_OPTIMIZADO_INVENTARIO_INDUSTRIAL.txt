# ğŸ­ PROMPT OPTIMIZADO PARA SISTEMA DE INVENTARIO INDUSTRIAL

## ğŸ¯ CONTEXTO ESPECÃFICO DEL PROYECTO

### **Tipo de AplicaciÃ³n:**
Sistema de **Inventario Industrial** para gestiÃ³n de instrumentos, equipos y materiales industriales/mineros.

### **Dominios Principales:**
- **Usuarios**: AutenticaciÃ³n y autorizaciÃ³n (ADMIN, USER, VIEWER)
- **Productos**: GestiÃ³n de inventario con SKU, precios, stock crÃ­tico
- **CategorÃ­as**: ClasificaciÃ³n jerÃ¡rquica de productos
- **Ubicaciones**: GestiÃ³n de almacenes y ubicaciones fÃ­sicas
- **Proveedores**: GestiÃ³n de proveedores y contactos
- **Movimientos**: Trazabilidad de entradas/salidas de inventario
- **AuditorÃ­a**: Logs automÃ¡ticos de todas las operaciones

### **Reglas de Negocio CrÃ­ticas:**
- âœ… **Stock crÃ­tico**: Alertas automÃ¡ticas cuando `quantity <= critical_stock`
- âœ… **Trazabilidad completa**: Todos los movimientos deben ser auditables
- âœ… **SKU Ãºnico**: Cada producto debe tener un cÃ³digo SKU Ãºnico
- âœ… **JerarquÃ­a de categorÃ­as**: CategorÃ­as pueden tener subcategorÃ­as
- âœ… **Movimientos de inventario**: IN (entrada), OUT (salida), ADJUSTMENT (ajuste)
- âœ… **AuditorÃ­a automÃ¡tica**: Triggers PostgreSQL para todas las operaciones CRUD

### **Casos de Uso Prioritarios:**
1. **GestiÃ³n de Productos**: CRUD completo con validaciones de stock
2. **Movimientos de Inventario**: Entradas, salidas y ajustes con trazabilidad
3. **Alertas de Stock CrÃ­tico**: Notificaciones automÃ¡ticas
4. **Reportes de AuditorÃ­a**: Historial completo de cambios
5. **GestiÃ³n de Ubicaciones**: Control de almacenes y estantes
6. **GestiÃ³n de Proveedores**: InformaciÃ³n de contacto y productos asociados

## ğŸ—ï¸ ARQUITECTURA Y ESTRUCTURA

### **TecnologÃ­as del Stack:**
- **TypeScript** (ES2020, strict mode)
- **Node.js** con Express.js
- **PostgreSQL** con pg driver
- **Clean Architecture** (4 capas bien definidas)
- **Jest** para testing con ts-jest
- **Winston** para logging estructurado
- **Zod** para validaciÃ³n de datos en runtime
- **bcrypt** para encriptaciÃ³n de contraseÃ±as
- **jsonwebtoken** para autenticaciÃ³n JWT
- **Swagger/OpenAPI** para documentaciÃ³n
- **pnpm** como package manager
- **Husky** + **commitlint** para Conventional Commits
- **ESLint** + **Prettier** para calidad de cÃ³digo
- **Docker** para containerizaciÃ³n

### **Estructura de Carpetas:**
```
src/
â”œâ”€â”€ 00-constants/          # Constantes globales
â”œâ”€â”€ 01-domain/            # Entidades y reglas de negocio
â”œâ”€â”€ 02-application/       # Casos de uso y DTOs
â”œâ”€â”€ 03-infrastructure/    # Implementaciones concretas
â”œâ”€â”€ 04-presentation/      # Controllers y Express server
â””â”€â”€ __tests__/           # Tests unitarios e integraciÃ³n
```

### **Base de Datos (PostgreSQL):**
```sql
-- Entidades principales ya definidas en init.sql:
- users (id, email, password, name, role, is_active, timestamps)
- categories (id, name, description, parent_id, is_active, timestamps)
- locations (id, name, description, zone, shelf, is_active, timestamps)
- suppliers (id, name, contact_person, email, phone, address, is_active, timestamps)
- products (id, name, description, sku, price, quantity, critical_stock, category_id, location_id, supplier_id, is_active, timestamps)
- product_movements (id, product_id, movement_type, quantity, previous_quantity, new_quantity, reason, user_id, created_at)
- audit_logs (id, table_name, record_id, action, old_values, new_values, user_id, ip_address, user_agent, created_at)
```

### **Vistas Ãštiles Implementadas:**
- `products_full_info`: Productos con informaciÃ³n completa
- `critical_stock_products`: Productos en stock crÃ­tico
- `recent_movements`: Movimientos recientes con detalles

## ğŸ¨ GENERACIÃ“N DE DIAGRAMA ERD

### **1. Diagrama PlantUML Mejorado**
```plantuml
@startuml
!define RECTANGLE class

skinparam classAttributeIconSize 0
skinparam backgroundColor #FFFFFF
skinparam roundcorner 5
skinparam shadowing false

skinparam class {
    BackgroundColor #F8F9FA
    BorderColor #6C757D
    FontColor #212529
}

' Entidades principales
RECTANGLE "users" as Users #E3F2FD {
    +id: serial [PK]
    +email: varchar(100) [UK]
    +password: varchar(255)
    +name: varchar(100)
    +role: varchar(20)
    +is_active: boolean
    +created_at: timestamp
    +updated_at: timestamp
    --
    [INDEX] idx_users_email
    [INDEX] idx_users_role
}

RECTANGLE "categories" as Categories #E8F5E8 {
    +id: serial [PK]
    +name: varchar(100) [UK]
    +description: text
    +parent_id: int [FK]
    +is_active: boolean
    +created_at: timestamp
    +updated_at: timestamp
    --
    [INDEX] idx_categories_parent_id
    [INDEX] idx_categories_is_active
}

RECTANGLE "locations" as Locations #FFF3E0 {
    +id: serial [PK]
    +name: varchar(100)
    +description: text
    +zone: varchar(50)
    +shelf: varchar(50)
    +is_active: boolean
    +created_at: timestamp
    +updated_at: timestamp
}

RECTANGLE "suppliers" as Suppliers #F3E5F5 {
    +id: serial [PK]
    +name: varchar(200)
    +contact_person: varchar(100)
    +email: varchar(100)
    +phone: varchar(20)
    +address: text
    +is_active: boolean
    +created_at: timestamp
    +updated_at: timestamp
}

RECTANGLE "products" as Products #FFEBEE {
    +id: serial [PK]
    +name: varchar(255)
    +description: text
    +sku: varchar(50) [UK]
    +price: numeric(10,2)
    +quantity: int
    +critical_stock: int
    +category_id: int [FK]
    +location_id: int [FK]
    +supplier_id: int [FK]
    +is_active: boolean
    +created_at: timestamp
    +updated_at: timestamp
    --
    [INDEX] idx_products_category_id
    [INDEX] idx_products_location_id
    [INDEX] idx_products_supplier_id
    [INDEX] idx_products_is_active
    [INDEX] idx_products_sku
    [INDEX] idx_products_name
}

RECTANGLE "product_movements" as Movements #FFF8E1 {
    +id: serial [PK]
    +product_id: int [FK]
    +movement_type: varchar(20)
    +quantity: int
    +previous_quantity: int
    +new_quantity: int
    +reason: varchar(200)
    +user_id: int [FK]
    +created_at: timestamp
    --
    [INDEX] idx_product_movements_product_id
    [INDEX] idx_product_movements_user_id
    [INDEX] idx_product_movements_created_at
}

RECTANGLE "audit_logs" as AuditLogs #F5F5F5 {
    +id: serial [PK]
    +table_name: varchar(50)
    +record_id: int
    +action: varchar(20)
    +old_values: jsonb
    +new_values: jsonb
    +user_id: int [FK]
    +ip_address: inet
    +user_agent: text
    +created_at: timestamp
    --
    [INDEX] idx_audit_logs_table_name
    [INDEX] idx_audit_logs_user_id
    [INDEX] idx_audit_logs_created_at
}

' Vistas del sistema
RECTANGLE "products_full_info" as ProductsView #E1F5FE {
    [VIEW]
    +id, name, description, sku
    +price, quantity, critical_stock
    +category_name, location_name
    +supplier_name, stock_status
    +created_at, updated_at
}

RECTANGLE "critical_stock_products" as CriticalStockView #FFCDD2 {
    [VIEW]
    +id, name, sku, quantity
    +critical_stock, category_name
    +location_name, supplier_name
}

RECTANGLE "recent_movements" as MovementsView #FFF9C4 {
    [VIEW]
    +id, product_name, sku
    +movement_type, quantity
    +previous_quantity, new_quantity
    +reason, user_name, created_at
}

' Relaciones principales
Products ||--o{ Movements : "1:N\n(Un producto tiene muchos movimientos)"
Movements }o--|| Users : "N:1\n(Muchos movimientos los realiza un usuario)"
Products }o--|| Categories : "N:1\n(Muchos productos pertenecen a una categorÃ­a)"
Products }o--|| Locations : "N:1\n(Muchos productos estÃ¡n en una ubicaciÃ³n)"
Products }o--|| Suppliers : "N:1\n(Muchos productos tienen un proveedor)"
AuditLogs }o--|| Users : "N:1\n(Muchos logs los genera un usuario)"

' Auto-relaciÃ³n para jerarquÃ­a de categorÃ­as
Categories }o--|| Categories : "N:1\n(CategorÃ­as pueden tener subcategorÃ­as)"

' Relaciones de auditorÃ­a
AuditLogs ..> Products : "Audita cambios"
AuditLogs ..> Categories : "Audita cambios"
AuditLogs ..> Locations : "Audita cambios"
AuditLogs ..> Suppliers : "Audita cambios"

' Vistas relacionadas
ProductsView ..> Products : "Consulta"
CriticalStockView ..> Products : "Filtra stock crÃ­tico"
MovementsView ..> Movements : "Consulta con joins"

' Triggers y funciones
note top of Products : "TRIGGER: audit_products_trigger\nTRIGGER: check_critical_stock_trigger\nTRIGGER: update_products_updated_at"
note top of Categories : "TRIGGER: audit_categories_trigger\nTRIGGER: update_categories_updated_at"
note top of Locations : "TRIGGER: audit_locations_trigger\nTRIGGER: update_locations_updated_at"
note top of Suppliers : "TRIGGER: audit_suppliers_trigger\nTRIGGER: update_suppliers_updated_at"
note top of Users : "TRIGGER: update_users_updated_at"

' Notas del sistema
note as N1
**Sistema de Inventario Industrial**
- PostgreSQL con triggers de auditorÃ­a
- Trazabilidad completa de movimientos
- Alertas de stock crÃ­tico
- Roles: ADMIN, USER, VIEWER
- Movimientos: IN, OUT, ADJUSTMENT
end note

note as N2
**CaracterÃ­sticas TÃ©cnicas:**
- Ãndices optimizados para consultas
- Vistas para reportes comunes
- AuditorÃ­a automÃ¡tica con JSONB
- Validaciones de integridad
- Timestamps automÃ¡ticos
end note

@enduml
```

### **2. GeneraciÃ³n AutomÃ¡tica de PNG**
```bash
# Comando para generar el diagrama PNG
plantuml -tpng docs/database-erd-diagram.puml
# O usando Docker
docker run -v $(pwd):/data plantuml/plantuml -tpng /data/docs/database-erd-diagram.puml
```

### **3. CaracterÃ­sticas del Diagrama:**
- âœ… **Entidades principales** con todos los campos
- âœ… **Ãndices optimizados** para consultas
- âœ… **Triggers de auditorÃ­a** documentados
- âœ… **Vistas del sistema** para reportes
- âœ… **Relaciones** con cardinalidad clara
- âœ… **Notas tÃ©cnicas** del sistema
- âœ… **Colores diferenciados** por tipo de entidad

## ğŸ—ï¸ PRINCIPIOS Y ESTÃNDARES

### **1. Clean Architecture**
- âœ… **Dependencias unidireccionales**: Solo hacia adentro
- âœ… **InversiÃ³n de dependencias**: Interfaces en capas internas
- âœ… **SeparaciÃ³n clara de responsabilidades**: Cada capa tiene un propÃ³sito especÃ­fico
- âœ… **Independencia de frameworks**: La lÃ³gica de negocio no depende de Express
- âœ… **Trazabilidad**: Todas las operaciones deben ser auditables

### **2. TypeScript Best Practices**
- âœ… **Strict mode** habilitado
- âœ… **Interfaces explÃ­citas** para todos los contratos
- âœ… **Tipos genÃ©ricos** cuando sea apropiado
- âœ… **Enums** para valores constantes
- âœ… **Type guards** para validaciÃ³n de tipos
- âœ… **Utility types** de TypeScript

### **3. Quality Assurance**
- âœ… **ESLint** con reglas estrictas
- âœ… **Prettier** para formateo consistente
- âœ… **Husky** para pre-commit hooks
- âœ… **commitlint** para Conventional Commits
- âœ… **Jest** con coverage mÃ­nimo 90%
- âœ… **TypeScript** strict mode
- âœ… **ValidaciÃ³n de seguridad** para operaciones crÃ­ticas

## ğŸ”§ PATRONES DE DISEÃ‘O

### **1. Repository Pattern con AuditorÃ­a**
```typescript
interface ProductRepository {
  create(product: Product): Promise<Product>;
  findById(id: number): Promise<Product | null>;
  findBySku(sku: string): Promise<Product | null>;
  findAll(): Promise<Product[]>;
  update(id: number, product: Partial<Product>): Promise<Product>;
  delete(id: number): Promise<void>;
  
  // MÃ©todos especÃ­ficos del dominio
  findByCategory(categoryId: number): Promise<Product[]>;
  findByLocation(locationId: number): Promise<Product[]>;
  findCriticalStock(): Promise<Product[]>;
  findLowStock(): Promise<Product[]>;
  
  // Movimientos de inventario
  addMovement(movement: ProductMovement): Promise<ProductMovement>;
  getMovements(productId: number): Promise<ProductMovement[]>;
  
  // AuditorÃ­a
  getAuditTrail(productId: number): Promise<AuditLog[]>;
}
```

### **2. Use Case Pattern con Validaciones**
```typescript
class CreateProductUseCase {
  constructor(
    private productRepository: ProductRepository,
    private logger: LoggerWrapperInterface,
    private validator: ProductValidator
  ) {}
  
  async execute(data: CreateProductDTO): Promise<Product> {
    // Validaciones especÃ­ficas del dominio
    await this.validator.validateProduct(data);
    await this.validator.validateSkuUniqueness(data.sku);
    
    // LÃ³gica de negocio
    const product = new Product(data);
    
    // AuditorÃ­a automÃ¡tica
    await this.logger.info('Product created', {
      productId: product.getId(),
      sku: product.getSku(),
      createdBy: data.createdBy,
      metadata: { category: data.categoryId, location: data.locationId }
    });
    
    return product;
  }
}
```

### **3. Movement Use Case con Trazabilidad**
```typescript
class AddProductMovementUseCase {
  constructor(
    private productRepository: ProductRepository,
    private movementRepository: ProductMovementRepository,
    private logger: LoggerWrapperInterface
  ) {}
  
  async execute(data: AddMovementDTO): Promise<ProductMovement> {
    const product = await this.productRepository.findById(data.productId);
    if (!product) throw new NotFoundError('Product', data.productId);
    
    const previousQuantity = product.getQuantity();
    const newQuantity = this.calculateNewQuantity(previousQuantity, data);
    
    // Validar stock suficiente para salidas
    if (data.movementType === 'OUT' && newQuantity < 0) {
      throw new InsufficientStockError(product.getSku(), previousQuantity, data.quantity);
    }
    
    // Crear movimiento
    const movement = new ProductMovement({
      productId: data.productId,
      movementType: data.movementType,
      quantity: data.quantity,
      previousQuantity,
      newQuantity,
      reason: data.reason,
      userId: data.userId
    });
    
    // Actualizar stock del producto
    await this.productRepository.update(data.productId, { quantity: newQuantity });
    
    // Guardar movimiento
    const savedMovement = await this.movementRepository.create(movement);
    
    // AuditorÃ­a
    await this.logger.info('Product movement added', {
      productId: data.productId,
      movementType: data.movementType,
      quantity: data.quantity,
      newQuantity,
      userId: data.userId
    });
    
    return savedMovement;
  }
}
```

### **4. Dependency Injection**
- âœ… **Constructor injection** para dependencias
- âœ… **Interface segregation** para contratos especÃ­ficos
- âœ… **Factory pattern** para creaciÃ³n de instancias
- âœ… **Validators** para operaciones crÃ­ticas

## ğŸ›¡ï¸ MANEJO DE ERRORES Y VALIDACIONES

### **1. Error Hierarchy**
```typescript
class DomainError extends Error {
  constructor(message: string, public code: string, public severity: 'LOW' | 'MEDIUM' | 'HIGH' | 'CRITICAL') {
    super(message);
    this.name = 'DomainError';
  }
}

class ValidationError extends DomainError {
  constructor(field: string, message: string) {
    super(`Validation error in ${field}: ${message}`, 'VALIDATION_ERROR', 'HIGH');
  }
}

class NotFoundError extends DomainError {
  constructor(entityType: string, id: number) {
    super(`${entityType} with ID ${id} not found`, 'NOT_FOUND', 'MEDIUM');
  }
}

class InsufficientStockError extends DomainError {
  constructor(sku: string, currentStock: number, requestedQuantity: number) {
    super(`Insufficient stock for SKU ${sku}. Current: ${currentStock}, Requested: ${requestedQuantity}`, 'INSUFFICIENT_STOCK', 'HIGH');
  }
}
```

### **2. Zod Validation para Datos**
```typescript
const ProductSchema = z.object({
  name: z.string().min(1, 'Name is required').max(255),
  description: z.string().optional(),
  sku: z.string().min(1, 'SKU is required').max(50).regex(/^[A-Z0-9-]+$/, 'SKU must contain only uppercase letters, numbers and hyphens'),
  price: z.number().positive('Price must be positive'),
  quantity: z.number().int().min(0, 'Quantity cannot be negative'),
  critical_stock: z.number().int().min(0, 'Critical stock cannot be negative'),
  category_id: z.number().int().positive('Category is required'),
  location_id: z.number().int().positive().optional(),
  supplier_id: z.number().int().positive().optional(),
  is_active: z.boolean().default(true)
});

const MovementSchema = z.object({
  product_id: z.number().int().positive('Product ID is required'),
  movement_type: z.enum(['IN', 'OUT', 'ADJUSTMENT'], 'Invalid movement type'),
  quantity: z.number().int().positive('Quantity must be positive'),
  reason: z.string().min(1, 'Reason is required').max(200),
  user_id: z.number().int().positive('User ID is required')
});
```

### **3. Winston Logging con AuditorÃ­a**
```typescript
const logger = winston.createLogger({
  level: 'info',
  format: winston.format.combine(
    winston.format.timestamp(),
    winston.format.errors({ stack: true }),
    winston.format.json()
  ),
  defaultMeta: { 
    service: 'inventory-api',
    environment: process.env.NODE_ENV,
    version: process.env.APP_VERSION
  },
  transports: [
    new winston.transports.File({ 
      filename: 'logs/error.log', 
      level: 'error',
      maxsize: 5242880, // 5MB
      maxFiles: 5
    }),
    new winston.transports.File({ 
      filename: 'logs/audit.log',
      level: 'info',
      format: winston.format.combine(
        winston.format.timestamp(),
        winston.format.json()
      )
    }),
    new winston.transports.File({ 
      filename: 'logs/combined.log' 
    })
  ]
});
```

## ğŸ§ª TESTING STRATEGY

### **1. Unit Tests con Coverage 90%**
```typescript
describe('Product Domain', () => {
  it('should create product with valid SKU', () => {
    const product = new Product({
      name: 'Sensor Industrial',
      sku: 'SENS-001',
      price: 1000,
      quantity: 10,
      critical_stock: 5
    });
    
    expect(product.getSku()).toBe('SENS-001');
    expect(product.isInCriticalStock()).toBe(false);
  });

  it('should detect critical stock', () => {
    const product = new Product({
      name: 'Sensor Industrial',
      sku: 'SENS-001',
      price: 1000,
      quantity: 3,
      critical_stock: 5
    });
    
    expect(product.isInCriticalStock()).toBe(true);
  });

  it('should throw error for invalid data', () => {
    expect(() => new Product({
      name: '', // Invalid: empty name
      sku: 'SENS-001',
      price: 1000,
      quantity: 10,
      critical_stock: 5
    })).toThrow('Name is required');
  });
});
```

### **2. Integration Tests**
```typescript
describe('Product Movement Integration', () => {
  it('should handle inventory movement with audit trail', async () => {
    const product = await createTestProduct();
    const user = await createTestUser();
    
    const movement = await addProductMovementUseCase.execute({
      productId: product.getId(),
      movementType: 'IN',
      quantity: 10,
      reason: 'Initial stock',
      userId: user.getId()
    });
    
    const updatedProduct = await productRepository.findById(product.getId());
    const auditTrail = await productRepository.getAuditTrail(product.getId());
    
    expect(updatedProduct.getQuantity()).toBe(10);
    expect(auditTrail).toHaveLength(2); // Product creation + movement
  });
});
```

## ğŸ“ CONVENTIONAL COMMITS CON HUSKY

### **1. ConfiguraciÃ³n de Husky**
```json
{
  "husky": {
    "hooks": {
      "pre-commit": "lint-staged && npm run test:coverage",
      "commit-msg": "commitlint -E HUSKY_GIT_PARAMS",
      "pre-push": "npm run test:integration"
    }
  },
  "lint-staged": {
    "*.{ts,js}": [
      "eslint --fix",
      "prettier --write",
      "git add"
    ],
    "*.{json,md}": [
      "prettier --write",
      "git add"
    ]
  }
}
```

### **2. Commitlint Configuration**
```javascript
// commitlint.config.js
module.exports = {
  extends: ['@commitlint/config-conventional'],
  rules: {
    'type-enum': [
      2,
      'always',
      [
        'feat',
        'fix',
        'docs',
        'style',
        'refactor',
        'perf',
        'test',
        'chore',
        'revert',
        'ci',
        'build',
        'security',
        'audit'
      ]
    ],
    'scope-enum': [
      2,
      'always',
      [
        'auth',
        'users',
        'products',
        'categories',
        'locations',
        'suppliers',
        'movements',
        'audit',
        'validation',
        'security',
        'api',
        'database'
      ]
    ]
  }
};
```

### **3. Conventional Commits Format**
```
<type>[optional scope]: <description>

[optional body]

[optional footer(s)]
```

**Ejemplos:**
- `feat(products): add product creation endpoint`
- `fix(validation): resolve SKU validation issue`
- `security(audit): implement enhanced audit trail`
- `test(movements): add comprehensive movement tests`
- `audit(products): implement product lifecycle tracking`

## ğŸ“Š MÃ‰TRICAS Y MONITOREO

### **1. KPIs del Sistema**
- Stock crÃ­tico por categorÃ­a
- Movimientos por perÃ­odo
- Productos mÃ¡s movidos
- Alertas de stock generadas
- Usuarios mÃ¡s activos

### **2. Alertas AutomÃ¡ticas**
```typescript
class StockAlertService {
  async checkCriticalStock(): Promise<Alert[]> {
    const criticalProducts = await this.productRepository.findCriticalStock();
    
    return criticalProducts.map(product => ({
      type: 'CRITICAL_STOCK',
      severity: 'HIGH',
      message: `Product ${product.getSku()} is in critical stock`,
      productId: product.getId(),
      currentQuantity: product.getQuantity(),
      criticalStock: product.getCriticalStock()
    }));
  }
}
```

## ğŸš€ ENTRYGABLES ESPECÃFICOS

### **1. Endpoints REST API**
```
POST   /api/auth/login
POST   /api/auth/register
GET    /api/auth/profile

GET    /api/products
POST   /api/products
GET    /api/products/:id
PUT    /api/products/:id
DELETE /api/products/:id
GET    /api/products/:id/movements
POST   /api/products/:id/movements

GET    /api/categories
POST   /api/categories
GET    /api/categories/:id
PUT    /api/categories/:id
DELETE /api/categories/:id

GET    /api/locations
POST   /api/locations
GET    /api/locations/:id
PUT    /api/locations/:id
DELETE /api/locations/:id

GET    /api/suppliers
POST   /api/suppliers
GET    /api/suppliers/:id
PUT    /api/suppliers/:id
DELETE /api/suppliers/:id

GET    /api/audit-logs
GET    /api/audit-logs/:table/:id

GET    /api/reports/critical-stock
GET    /api/reports/movements
GET    /api/reports/inventory-value
```

### **2. DocumentaciÃ³n Swagger**
- Esquemas completos para todas las entidades
- Ejemplos de requests/responses
- CÃ³digos de error especÃ­ficos
- AutenticaciÃ³n JWT documentada

## ğŸ”„ FORMATO DE RESPUESTA

### **ANÃLISIS:**
- ğŸ” Identificar problemas de arquitectura
- ğŸš¨ Detectar violaciones de Clean Architecture
- ğŸ’¡ Sugerir mejoras de estructura
- ğŸ“Š Evaluar calidad del cÃ³digo actual
- ğŸ›¡ï¸ Revisar implementaciÃ³n de seguridad y auditorÃ­a

### **REFACTORIZACIÃ“N:**
- ğŸ—ï¸ CÃ³digo refactorizado por capas siguiendo Clean Architecture
- ğŸ“ ExplicaciÃ³n de cada cambio con justificaciÃ³n
- ğŸ¯ JustificaciÃ³n de decisiones arquitectÃ³nicas
- ğŸ”§ ImplementaciÃ³n de patrones de diseÃ±o
- ğŸ›¡ï¸ ImplementaciÃ³n de validaciones de seguridad

### **MEJORAS ADICIONALES:**
- âš¡ Optimizaciones de performance
- ğŸ”’ Mejoras de seguridad
- ğŸ“š DocumentaciÃ³n JSDoc completa
- ğŸ§ª Tests unitarios e integraciÃ³n con coverage 90%
- ğŸ¨ ConfiguraciÃ³n de herramientas de calidad
- ğŸ“Š ImplementaciÃ³n de auditorÃ­a y trazabilidad
- ğŸš¨ Sistema de alertas para operaciones crÃ­ticas
- ğŸ“ˆ GeneraciÃ³n de diagrama ERD en PNG

## ğŸš€ INSTRUCCIONES ESPECÃFICAS

### **1. Arquitectura y Estructura:**
- âœ… MantÃ©n la estructura de carpetas existente
- âœ… Usa interfaces para inversiÃ³n de dependencias
- âœ… Implementa proper error handling con errores especÃ­ficos del dominio
- âœ… AÃ±ade validaciones robustas con Zod
- âœ… Implementa auditorÃ­a automÃ¡tica para todas las operaciones

### **2. Testing y Calidad:**
- âœ… Considera testing en cada capa con coverage 90%
- âœ… Documenta con JSDoc completo
- âœ… Optimiza para performance y mantenibilidad
- âœ… Implementa tests de seguridad
- âœ… AÃ±ade tests de auditorÃ­a y trazabilidad

### **3. Herramientas de Desarrollo:**
- âœ… Configura Husky para pre-commit hooks
- âœ… Implementa commitlint para Conventional Commits
- âœ… Configura ESLint y Prettier con reglas estrictas
- âœ… Establece lint-staged para archivos modificados
- âœ… Implementa validaciones de seguridad en pre-commit

### **4. Logging y Monitoreo:**
- âœ… Usa Winston para logging estructurado con auditorÃ­a
- âœ… Implementa diferentes niveles de log (INFO, WARN, ERROR, CRITICAL)
- âœ… AÃ±ade contexto detallado en logs de error
- âœ… Configura rotaciÃ³n de logs con retenciÃ³n
- âœ… Implementa alertas para operaciones crÃ­ticas

### **5. Seguridad:**
- âœ… Valida todas las entradas con Zod
- âœ… Implementa sanitizaciÃ³n de datos
- âœ… Usa bcrypt para hashing de contraseÃ±as
- âœ… Implementa rate limiting para endpoints sensibles
- âœ… AÃ±ade validaciones de seguridad especÃ­ficas
- âœ… Implementa auditorÃ­a automÃ¡tica de todas las operaciones

### **6. DocumentaciÃ³n Visual:**
- âœ… Genera diagrama ERD en PNG usando PlantUML
- âœ… Incluye Ã­ndices y triggers en el diagrama
- âœ… Documenta vistas del sistema
- âœ… Muestra relaciones con cardinalidad clara
- âœ… AÃ±ade notas tÃ©cnicas del sistema

## ğŸ“‹ CHECKLIST DE ENTREGA

### **Antes de Proporcionar el CÃ³digo:**
- [x] âœ… Sistema de Inventario Industrial
- [x] âœ… PostgreSQL con triggers de auditorÃ­a
- [x] âœ… Docker configurado
- [x] âœ… Estructura de base de datos completa
- [x] âœ… Reglas de negocio definidas
- [x] âœ… Diagrama PlantUML mejorado

### **DespuÃ©s de la RefactorizaciÃ³n:**
- [ ] âœ… Clean Architecture implementada
- [ ] âœ… Validaciones de dominio con Zod
- [ ] âœ… Tests unitarios e integraciÃ³n (90% coverage)
- [ ] âœ… Logging estructurado con auditorÃ­a
- [ ] âœ… Husky y commitlint configurados
- [ ] âœ… ESLint y Prettier configurados
- [ ] âœ… DocumentaciÃ³n JSDoc completa
- [ ] âœ… Manejo de errores especÃ­ficos del dominio
- [ ] âœ… Type safety completo
- [ ] âœ… Performance optimizado
- [ ] âœ… AuditorÃ­a automÃ¡tica implementada
- [ ] âœ… Alertas de stock crÃ­tico
- [ ] âœ… Trazabilidad completa de movimientos
- [ ] âœ… Reportes y mÃ©tricas
- [ ] âœ… API REST documentada con Swagger
- [ ] âœ… Diagrama ERD en PNG generado

---

**ğŸ¯ OBJETIVO FINAL:** Crear un sistema robusto de inventario industrial que siga Clean Architecture, con trazabilidad completa, auditorÃ­a automÃ¡tica y alertas de stock crÃ­tico, optimizado para el manejo de instrumentos y equipos industriales, incluyendo documentaciÃ³n visual completa.

**ğŸ“ INSTRUCCIÃ“N:** Proporciona el cÃ³digo que quieres refactorizar y procederÃ© con el anÃ¡lisis y refactorizaciÃ³n completa siguiendo todos estos estÃ¡ndares y patrones especÃ­ficos para el sistema de inventario industrial, incluyendo la generaciÃ³n del diagrama ERD en PNG.

---

**ğŸ“„ ARCHIVO GENERADO:** PROMPT_OPTIMIZADO_INVENTARIO_INDUSTRIAL.txt
**ğŸ“… FECHA:** $(date)
**ğŸ·ï¸ VERSIÃ“N:** 1.0.0
**ğŸ“ AUTOR:** Senior Software Engineer - Clean Architecture Specialist 